/*! leeven 2015-01-29 */
!function(a){function b(){var b=a("#formFile").data("method"),c=a("#formFile").data("pid");"post"!==b&&(c=a("#formFile").data("fid")),a.myAjax({type:b,url:"/files/"+c,data:a("#formFile").serialize(),beforeSend:function(){a("#btnAddFile").addClass("loading")},success:function(b){b.status?window.location.reload():a(".msg-file-form").html(a.errMsg(b.result)).show()},error:function(){a(".msg-file-form").text("提交失败，请稍后重试").show()},complete:function(){a("#btnAddFile").removeClass("loading")}})}if(a(".page-files").length){a(".item").on("click",">a",function(){var b=a(this).data("fid");a.myAjax({type:"get",url:"/viewfile/"+b,success:function(c){if(c.status){var d="";a(".sidebar-view .header").text(c.result.name),a(".sidebar-view .btn-editfile").attr("href","/editfile/"+b),d=c.result.content?marked(c.result.content):'<span style="color: #bbb;">这个家伙很懒，什么都没有写……</span>',a(".sidebar-view .md-file").html(d),a(".sidebar-view").sidebar({overlay:!0}).sidebar("show")}}})}),a("#btnAddFile").on("click",function(){a(".sidebar-file .header").text("新增文档"),a("#formFile").data("method","post"),a(".del-file").css("display","none"),a(".sidebar-file").sidebar({overlay:!0}).sidebar("show")}),a(".setting-file").on("click",function(){var b=a(this);a(".sidebar-file .header").text("编辑文档"),a("#formFile").data("method","put"),a('#formFile input[name="name"]').val(b.parent().prev().find(".title").text()),a("#formFile").data("fid",b.data("fid")),a(".del-file").css("display","block"),a(".sidebar-file").sidebar({overlay:!0}).sidebar("show")}),a(".del-file").on("click",function(){confirm("确定要删除该文档？")&&(a("#formFile").data("method","delete"),b())});var c={name:{identifier:"name",rules:[{type:"empty",prompt:"请输入文档名称"}]}};a("#formFile").form(c,{onSuccess:function(){return b(),!1},onFailure:function(){return!1}})}}(window.jQuery);