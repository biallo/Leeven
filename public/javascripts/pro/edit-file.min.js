/*! leeven 2015-02-03 */
!function(a){function b(){var b=marked(f.session.getValue());a(".preview").html(b).scrollTop(a(".preview")[0].scrollHeight),f.session.getUndoManager().markClean()}function c(){a.myAjax({type:"put",url:"/editfile/"+a("#editor").data("fid"),data:{content:f.session.getValue()},beforeSend:function(){a("#btnSaveFile").addClass("loading")},success:function(a){d(a.result.msg)},error:function(){d("提交失败，请稍后重试")},complete:function(){a("#btnSaveFile").removeClass("loading")}})}function d(b){clearTimeout(e.timer),a(".editor-msg").text(b),e.timer=setTimeout(function(){a(".editor-msg").transition("flash",function(){a(this).text("")})},3e3)}if(a(".page-edit-file").length){var e={timer:""},f=ace.edit(a("#editor")[0]);f.setTheme("ace/theme/monokai"),f.setFontSize("16px"),f.getSession().setUseWrapMode(!0),f.getSession().setMode("ace/mode/markdown"),f.setAnimatedScroll(!0),f.setHighlightActiveLine(!0),f.renderer.setShowGutter(!0),f.setReadOnly(!1),f.setBehavioursEnabled(!0),f.setHighlightSelectedWord(!0),f.setAnimatedScroll(!0),f.setShowInvisibles(!1),f.setSelectionStyle("text"),f.getSession().setUseWorker(!0),f.session.setValue(a("#editor").data("content"),-1),b(),f.commands.addCommand({name:"saveCommand",bindKey:{win:"Ctrl-s",mac:"Command-s"},exec:function(){c()},readOnly:!1}),f.getSession().on("change",function(){var a=f.session.getUndoManager().isClean();a||b()}),a("#btnSaveFile").on("click",function(){c()})}}(window.jQuery);